{{ config(schema="_airbyte_public", tags=["top-level-intermediate"]) }}
-- SQL model to parse JSON blob stored in a single column and extract into separated field columns as described by the JSON Schema
select
    {{ json_extract_scalar('_airbyte_data', ['id']) }} as {{ adapter.quote('id') }},
    {{ json_extract_scalar('_airbyte_data', ['url']) }} as url,
    {{ json_extract('_airbyte_data', ['base']) }} as base,
    {{ json_extract_scalar('_airbyte_data', ['body']) }} as body,
    {{ json_extract('_airbyte_data', ['head']) }} as head,
    {{ json_extract_scalar('_airbyte_data', ['draft']) }} as draft,
    {{ json_extract_scalar('_airbyte_data', ['state']) }} as {{ adapter.quote('state') }},
    {{ json_extract_scalar('_airbyte_data', ['title']) }} as title,
    {{ json_extract('_airbyte_data', ['_links']) }} as _links,
    {{ json_extract_array('_airbyte_data', ['labels']) }} as labels,
    {{ json_extract_scalar('_airbyte_data', ['locked']) }} as {{ adapter.quote('locked') }},
    {{ json_extract_scalar('_airbyte_data', ['number']) }} as {{ adapter.quote('number') }},
    {{ json_extract_scalar('_airbyte_data', ['node_id']) }} as node_id,
    {{ json_extract_scalar('_airbyte_data', ['user_id']) }} as user_id,
    {{ json_extract_scalar('_airbyte_data', ['diff_url']) }} as diff_url,
    {{ json_extract_scalar('_airbyte_data', ['html_url']) }} as html_url,
    {{ json_extract_array('_airbyte_data', ['assignees']) }} as assignees,
    {{ json_extract_scalar('_airbyte_data', ['closed_at']) }} as closed_at,
    {{ json_extract_scalar('_airbyte_data', ['issue_url']) }} as issue_url,
    {{ json_extract_scalar('_airbyte_data', ['merged_at']) }} as merged_at,
    {{ json_extract_scalar('_airbyte_data', ['patch_url']) }} as patch_url,
    {{ json_extract_scalar('_airbyte_data', ['auto_merge']) }} as auto_merge,
    {{ json_extract_scalar('_airbyte_data', ['created_at']) }} as created_at,
    {{ json_extract_scalar('_airbyte_data', ['updated_at']) }} as updated_at,
    {{ json_extract_scalar('_airbyte_data', ['assignee_id']) }} as assignee_id,
    {{ json_extract_scalar('_airbyte_data', ['commits_url']) }} as commits_url,
    {{ json_extract_scalar('_airbyte_data', ['comments_url']) }} as comments_url,
    {{ json_extract_scalar('_airbyte_data', ['milestone_id']) }} as milestone_id,
    {{ json_extract_scalar('_airbyte_data', ['statuses_url']) }} as statuses_url,
    {{ json_extract_array('_airbyte_data', ['requested_teams']) }} as requested_teams,
    {{ json_extract_scalar('_airbyte_data', ['merge_commit_sha']) }} as merge_commit_sha,
    {{ json_extract_scalar('_airbyte_data', ['active_lock_reason']) }} as active_lock_reason,
    {{ json_extract_scalar('_airbyte_data', ['author_association']) }} as author_association,
    {{ json_extract_scalar('_airbyte_data', ['review_comment_url']) }} as review_comment_url,
    {{ json_extract_array('_airbyte_data', ['requested_reviewers']) }} as requested_reviewers,
    {{ json_extract_scalar('_airbyte_data', ['review_comments_url']) }} as review_comments_url,
    {{ json_extract_scalar('_airbyte_data', ['_ab_github_repository']) }} as _ab_github_repository,
    _airbyte_emitted_at
from {{ source('public', '_airbyte_raw_tydo_pull_requests') }}
-- tydo_pull_requests

